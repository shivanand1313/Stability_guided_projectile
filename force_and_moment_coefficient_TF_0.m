% 6682	5/7/2010 12:18:07 PM
% Bomb Model-II Body + TailFins + delta 0
format long g

g = 9.81;
Cl = [];
Alpha = [];
C_m = [];

%Balance load matrix
CM = [63.080043	0.144499	-0.206795	1.354260	1.630051	4.275882
    -0.123649	150.309342	0.592082	-0.725847	0.030856	0.393628
    0.024098	-0.689773	151.831777	0.096597	-0.571799	-4.414537
    0.152944	-2.334107	0.037781	77.595997	0.445712	5.841784
    -0.006030	0.114642	-0.574072	-0.065800	79.176337	0.322466
    0.047415	0.466131	0.099431	0.208017	0.190935	44.877349 ];

% Model reference parameters
% Sref(sqm)	        Chord (m)	    Span (m)
Sref = 0.009677;	c = 0.111;	    b = 0.111;

% Moment reference point (nose)
% X (m)		Y (m)		Z (m)
% 0	        0	        0

% Balance center location
%X (m)		Y (m)		Z (m)
X =-0.465;	Y = 0;	    Z = 0;

% Nowind data
%     Ax		    N1		    N2		    S1		    S2		    Rm
NW = [-0.000122	    -0.000856	0.000737	-0.000887	-0.000321	0.000540];

for i = 1:3
if i == 1
% Data for Speed 1
DyHi = 963.625000;
%       Dyn. head	Pitch		Yaw		    Roll		Ax		    N1		    N2		    S1		    S2		    Rm
DSi = [ 963.625000	-9.947917	0.000000	0.000000	0.004041	0.010666	-0.025613	0.000252	-0.001648	0.000556
        963.625000	-8.052083	0.000000	0.000000	0.004303	0.008047	-0.019603	0.000321	-0.001890	0.000534
        963.625000	-6.052083	0.000000	0.000000	0.004447	0.005590	-0.013974	0.000369	-0.002227	0.000534
        963.625000	-4.062500	0.000000	0.000000	0.004555	0.003472	-0.009070	0.000284	-0.002226	0.000534
        963.625000	-2.062500	0.000000	0.000000	0.004576	0.001695	-0.004794	0.000163	-0.002093	0.000550
        963.625000	-0.052083	0.000000	0.000000	0.004651	0.000305	-0.001106	0.000120	-0.002148	0.000567
        963.625000	0.052083	0.000000	0.000000	0.004584	0.000547	-0.001454	0.000067	-0.002030	0.000546
        963.625000	1.947917	0.000000	0.000000	0.004693	-0.000915	0.002245	-0.000069	-0.001849	0.000555
        963.625000	3.947917	0.000000	0.000000	0.004635	-0.002199	0.005815	-0.000038	-0.001871	0.000523
        963.625000	5.947917	0.000000	0.000000	0.004555	-0.003961	0.010213	-0.000020	-0.002064	0.000510
        963.625000	7.947917	0.000000	0.000000	0.004402	-0.006041	0.015162	0.000073	-0.002172	0.000510
        963.625000	9.947917	0.000000	0.000000	0.004198	-0.008423	0.020711	0.000142	-0.002359	0.000489
        963.625000	11.947917	0.000000	0.000000	0.003985	-0.011058	0.026797	0.000099	-0.002414	0.000472
        963.625000	13.947917	0.000000	0.000000	0.003639	-0.013887	0.033287	-0.000001	-0.002484	0.000497
        963.625000	15.937500	0.000000	0.000000	0.003190	-0.016762	0.040025	-0.000171	-0.002655	0.000532
        963.625000	17.947917	0.000000	0.000000	0.002619	-0.019732	0.046936	-0.000346	-0.002734	0.000544
        963.625000	19.947917	0.000000	0.000000	0.002035	-0.022735	0.054030	-0.000156	-0.003364	0.000573
        963.625000	21.947917	0.000000	0.000000	0.001441	-0.025527	0.060936	0.000338	-0.004356	0.000604
        963.625000	23.947917	0.000000	0.000000	0.000957	-0.028028	0.067456	0.000961	-0.005535	0.000605
        963.625000	25.947917	0.000000	0.000000	0.000578	-0.030400	0.073778	0.001760	-0.006996	0.000559];%20
end
if i == 2
%Data for Speed 2
DyHi = 1499.386364;
%       Dyn. head	Pitch		Yaw		    Roll		Ax		    N1		    N2		    S1		    S2		    Rm
DSi = [ 1499.386364	-9.947917	0.000000	0.000000	0.006192	0.017118	-0.040181	0.000769	-0.002234	0.000427
        1499.386364	-8.052083	0.000000	0.000000	0.006619	0.012885	-0.030711	0.000806	-0.002535	0.000410
        1499.386364	-6.052083	0.000000	0.000000	0.006860	0.009008	-0.021985	0.000831	-0.002845	0.000420
        1499.386364	-4.062500	0.000000	0.000000	0.006959	0.005793	-0.014346	0.000839	-0.003119	0.000437
        1499.386364	-2.062500	0.000000	0.000000	0.007005	0.003054	-0.007697	0.000672	-0.002936	0.000459
        1499.386364	-0.052083	0.000000	0.000000	0.007247	0.000935	-0.002148	0.000640	-0.002946	0.000453
        1499.386364	0.052083	0.000000	0.000000	0.007197	0.001408	-0.002803	0.000683	-0.003116	0.000353
        1499.386364	1.947917	0.000000	0.000000	0.007292	-0.000859	0.002949	0.000351	-0.002659	0.000453
        1499.386364	3.947917	0.000000	0.000000	0.007147	-0.002855	0.008485	0.000383	-0.002782	0.000404
        1499.386364	5.947917	0.000000	0.000000	0.006977	-0.005520	0.015198	0.000453	-0.003028	0.000383
        1499.386364	7.947917	0.000000	0.000000	0.006738	-0.008735	0.022893	0.000535	-0.003259	0.000389
        1499.386364	9.947917	0.000000	0.000000	0.006384	-0.012340	0.031270	0.000529	-0.003350	0.000388
        1499.386364	11.947917	0.000000	0.000000	0.005978	-0.016281	0.040472	0.000398	-0.003254	0.000395
        1499.386364	13.947917	0.000000	0.000000	0.005398	-0.020568	0.050442	0.000122	-0.003142	0.000422
        1499.386364	15.937500	0.000000	0.000000	0.004632	-0.024889	0.060678	-0.000161	-0.003173	0.000425
        1499.386364	17.947917	0.000000	0.000000	0.003812	-0.029468	0.071419	-0.000126	-0.003874	0.000452
        1499.386364	19.947917	0.000000	0.000000	0.002842	-0.034292	0.082750	0.000341	-0.004938	0.000484
        1499.386364	21.947917	0.000000	0.000000	0.001930	-0.038580	0.093416	0.000817	-0.006238	0.000512
        1499.386364	23.947917	0.000000	0.000000	0.001100	-0.042682	0.103847	0.001550	-0.007834	0.000488
        1499.386364	25.947917	0.000000	0.000000	0.000524	-0.046475	0.113832	0.002517	-0.009531	0.000386];
end
if i == 3
% Data for Speed 3
DyHi = 2161.352273;
%       Dyn. head	Pitch		Yaw		    Roll		Ax		    N1		    N2		    S1		    S2		    Rm
DSi = [ 2161.352273	-9.947917	0.000000	0.000000	0.008836	0.024858	-0.057997	0.001269	-0.002600	0.000182
        2161.352273	-8.052083	0.000000	0.000000	0.009400	0.018713	-0.044275	0.001252	-0.003004	0.000222
        2161.352273	-6.052083	0.000000	0.000000	0.009780	0.013089	-0.031601	0.001283	-0.003549	0.000215
        2161.352273	-4.062500	0.000000	0.000000	0.009910	0.008425	-0.020681	0.001316	-0.003819	0.000239
        2161.352273	-2.062500	0.000000	0.000000	0.010055	0.004581	-0.011271	0.001129	-0.003798	0.000268
        2161.352273	-0.052083	0.000000	0.000000	0.010363	0.001638	-0.003413	0.001218	-0.003882	0.000298
        2161.352273	0.052083	0.000000	0.000000	0.010244	0.002471	-0.004727	0.001314	-0.004084	0.000180
        2161.352273	1.947917	0.000000	0.000000	0.010392	-0.000876	0.003781	0.000918	-0.003675	0.000277
        2161.352273	3.947917	0.000000	0.000000	0.010159	-0.003681	0.011638	0.000994	-0.003892	0.000220
        2161.352273	5.947917	0.000000	0.000000	0.009890	-0.007414	0.021119	0.001058	-0.004055	0.000184
        2161.352273	7.947917	0.000000	0.000000	0.009468	-0.011798	0.031753	0.001049	-0.004277	0.000180
        2161.352273	9.947917	0.000000	0.000000	0.008968	-0.016698	0.043510	0.000856	-0.004142	0.000195
        2161.352273	11.947917	0.000000	0.000000	0.008362	-0.022478	0.057013	0.000479	-0.003784	0.000237
        2161.352273	13.947917	0.000000	0.000000	0.007455	-0.028467	0.071065	0.000064	-0.003655	0.000255
        2161.352273	15.947917	0.000000	0.000000	0.006470	-0.034854	0.085985	-0.000013	-0.004102	0.000282
        2161.352273	17.947917	0.000000	0.000000	0.005251	-0.041448	0.101465	0.000233	-0.005264	0.000327
        2161.352273	19.947917	0.000000	0.000000	0.003784	-0.048530	0.118006	0.000826	-0.006890	0.000381
        2161.352273	21.947917	0.000000	0.000000	0.002409	-0.054638	0.133241	0.001423	-0.008337	0.000397
        2161.352273	23.947917	0.000000	0.000000	0.001174	-0.060368	0.148189	0.002554	-0.010377	0.000379
        2161.352273	25.947917	0.000000	0.000000	0.000092	-0.065645	0.162470	0.003253	-0.011682	0.000273];

end
Le = 0.884;
% Transformation Matrix from CG to Body center
x = 0.0368; % Xnp --> 0.605 (Neutral point from nose)
y = 0;
z = 0;
TM =[-1,  0,  0,  0,  0,  0
      0,  1,  0,  0,  0,  0
      0,  0,  -1, 0,  0,  0
      0,  -z, y,  1,  0,  0
      z,  0,  -x, 0,  1,  0
      -y, x,  0,  0,  0,  1]; % Doubt


    for j = 1:20
        aj = [DSi(j,5) ; DSi(j,6) ; DSi(j,7) ; DSi(j,8) ; DSi(j,9) ; DSi(j,10)];
        % Convert the obtained normalized voltage signals to kg
        Aj = CM * (aj-NW);
        % Calculate the forces and moments about the balance center
        fm = [Aj(1) ; (Aj(4)+Aj(5)) ; (Aj(2)+Aj(3)) ; Aj(6) ; (Aj(2)-Aj(3))*0.065 ; (Aj(4)-Aj(5))*0.065].*g;
        % Transform the forces and moments to the body axis
        FM = [Aj(1) ; (Aj(4)+Aj(5)) ; (Aj(2)+Aj(3)) ; Aj(6) ; (Aj(2)-Aj(3))*0.065 ; (Aj(4)-Aj(5))*0.065].*g; 
        % Transform the forces and moments to the C.G of the flight vehicle
        FMcg = TM * FM;
        % The variation of longitudinal force and moment coefficients
        Cf = (1/(DyHi*Sref)).*[FMcg(1:3)];
        Cm = (1/(DyHi*Sref*Le)).*[FMcg(4:6)];
        
        Pitch = (DSi(j,2));
        % Variation of Aerodynamic force coefficients with angle of attack
        Aero_TM = [ sind(Pitch)   0   -cosd(Pitch)
                   -cosd(Pitch)   0   -sind(Pitch)
                   0              1   0];
        
        Aero_Coeff = Aero_TM*Cf;
        
        % Recording The Data
        Alpha = [Alpha; Pitch'];
        Cl  = [Cl; Aero_Coeff'];
        C_m = [C_m; Cm'];

    end
end

        A1= Alpha(1:20);
        B1= Cl(1:20,1);
        C1= Cl(1:20,2);
        D1= C_m(1:20,2);
        A2= Alpha(21:40);
        B2= Cl(21:40,1);
        C2= Cl(21:40,2);
        D2= C_m(21:40,2);
        A3= Alpha(41:60);
        B3= Cl(41:60,1);
        C3= Cl(41:60,2);
        D3= C_m(41:60,2);
        
        E1 = B1./C1;
        E2 = B2./C2;
        E3 = B3./C3;
        
        F1 = B1.^2;
        F2 = B2.^2;
        F3 = B3.^2;

% Calculating Slope of Moment Coefficient
%For V1
        cc1=0;
        Cm_Alpha1i = 0;
        Cl_Alpha1i = 0;
        k1_i=0;
        for l = 2:1:20
        D_Alpha1 =  A1(l)-A1(l-1) ;
        D_Cl1 = B1(l)-B1(l-1);
        D_Cm1 = D1(l)-D1(l-1);
        D_Cd1 = C1(l)-C1(l-1);
        D_Cl_2= F1(l)-F1(l-1);
        Cm_alpha1 = D_Cm1/D_Alpha1;
        Cl_alpha1 = D_Cl1/D_Alpha1;
        k1 = D_Cd1/D_Cl_2;
        Cl_Alpha1i = Cl_Alpha1i + Cl_alpha1;
        Cm_Alpha1i = Cm_Alpha1i + Cm_alpha1;
        k1_i = k1_i + k1;
        cc1 = cc1+1;
        end        
        F_Cm_Alpha1 = Cm_Alpha1i/cc1;
        F_Cl_Alpha1 = Cl_Alpha1i/cc1;
        F_k1 = k1_i/cc1;
        F_Cl_01 = (B1(7)+B1(6))./2;
        F_Cd_01 = (C1(7)+C1(6))./2;
        F_Cm_01 = (D1(6)+D1(7))./2;
        

        disp('For V1 = 40 m/s')
        disp('Average value of Cl_alpha')
        disp(F_Cl_Alpha1)
        disp('Average value of Cm_alpha')
        disp(F_Cm_Alpha1)
        disp('Average value of Cl_0')
        disp(F_Cl_01)
        disp('Average value of Cd_0')
        disp(F_Cd_01)
        disp('Average value of Cm_0')
        disp(F_Cm_01)
        disp('Average value of Oswald Factor')
        disp(k1)
    
%For V2
        cc2=0;
        Cm_Alpha2i = 0;
        Cl_Alpha2i = 0;
        k2_i=0;
        for l = 2:1:20
        D_Alpha2 =  A2(l)-A2(l-1) ;
        D_Cl2 = B2(l)-B2(l-1);
        D_Cm2 = D2(l)-D2(l-1);
        D_Cd2 = C2(l)-C2(l-1);
        D_Cl_22= F2(l)-F2(l-1);
        Cm_alpha2 = D_Cm2/D_Alpha2;
        Cl_alpha2 = D_Cl2/D_Alpha2;
        k2 = D_Cd2/D_Cl_22;
        Cl_Alpha2i = Cl_Alpha2i + Cl_alpha2;
        Cm_Alpha2i = Cm_Alpha2i + Cm_alpha2;
        k2_i = k2_i + k2;
        cc2 = cc2+1;
        end
        F_Cm_Alpha2 = Cm_Alpha2i/cc2;
        F_Cl_Alpha2 = Cl_Alpha2i/cc2;
        F_k2 = k2_i/cc2;
        F_Cl_02 = (B2(7)+B2(6))./2;
        F_Cd_02 = (C2(7)+C2(6))./2;
        F_Cm_02 = (D2(6)+D2(7))./2;
        disp('For V2 = 50 m/s')
        disp('Average value of Cl_alpha')
        disp(F_Cl_Alpha2)
        disp('Average value of Cm_alpha')
        disp(F_Cm_Alpha2)
        disp('Average value of Cl_0')
        disp(F_Cl_02)
        disp('Average value of Cd_0')
        disp(F_Cd_02)
        disp('Average value of Cm_0')
        disp(F_Cm_02)
        disp('Average value of Oswald Factor')
        disp(k2)
%For V3
        cc3=0;
        Cm_Alpha3i = 0;
        Cl_Alpha3i = 0;
        k3_i=0;
        for l = 2:1:20
        D_Alpha3 =  A3(l)-A3(l-1) ;
        D_Cl3 = B3(l)-B3(l-1);
        D_Cm3 = D3(l)-D3(l-1);
        D_Cd3 = C3(l)-C3(l-1);
        D_Cl_23= F3(l)-F3(l-1);
        k3 = D_Cd3/D_Cl_23;
        Cm_alpha3 = D_Cm3/D_Alpha3;
        Cl_alpha3 = D_Cl3/D_Alpha3;
        Cl_Alpha3i = Cl_Alpha3i + Cl_alpha3;
        Cm_Alpha3i = Cm_Alpha3i + Cm_alpha3;
        k3_i = k3_i + k3;
        cc3 = cc3+1;
        end
        F_Cm_Alpha3 = Cm_Alpha3i/cc3;
        F_Cl_Alpha3 = Cl_Alpha3i/cc3;
        F_k3 = k3_i/cc3;
        F_Cl_03 = (B3(7)+B3(6))./2;
        F_Cd_03 = (C3(7)+C3(6))./2;
        F_Cm_03 = (D3(6)+D3(7))./2;
        disp('For V3 = 60 m/s')
        disp('Average value of Cl_alpha')
        disp(F_Cl_Alpha3)
        disp('Average value of Cm_alpha')
        disp(F_Cm_Alpha3)
        disp('Average value of Cl_0')
        disp(F_Cl_03)
        disp('Average value of Cd_0')
        disp(F_Cd_03)
        disp('Average value of Cm_0')
        disp(F_Cm_03)
        disp('Average value of Oswald Factor')
        disp(k3)

figure(1)
subplot(4,1,1)        
        hold on
        plot(A1,B1,'r-*',A2,B2,'g--o',A3,B3,'b-+')   
        hold off       
        %xlabel('\alpha')
        ylabel('Cl')
        title('C_l vs \alpha')
        legend('V1=40m/s','V2=50m/s','V3=60m/s')
        grid on
subplot(4,1,2)
        hold on
        plot(A1,C1,'r-*',A2,C2,'g--o',A3,C3,'b-+')   
        hold off       
        %xlabel('\alpha')
        ylabel('C_d')
        title('C_d vs \alpha')
        legend('V1=40m/s','V2=50m/s','V3=60m/s')
        grid on
subplot(4,1,3)
        hold on
        plot(A1,E1,'r-*',A2,E2,'g--o',A3,E3,'b-+')   
        hold off       
        %xlabel('\alpha')
        ylabel('C_l/C_d')
        title('C_l/C_d vs \alpha')
        legend('V1=40m/s','V2=50m/s','V3=60m/s')
        grid on
subplot(4,1,4)
        hold on
        plot(A1,D1,'r-*',A2,D2,'g--o',A3,D3,'b-+')   
        hold off
        xlabel('\alpha')
        ylabel('C_m')
        %%%ylim([-2 2])
        title('C_m vs \alpha')
        legend('V1=40m/s','V2=50m/s','V3=60m/s')
        grid on

figure(2)
    hold on
    plot(F1,C1,'r-*',F2,C2,'g--o',F3,C3,'b-+')  
    hold off       
    xlabel('C_l^2')
    ylabel('C_d')
    title('C_d vs C_l^2')
    legend('V1=40m/s','V2=50m/s','V3=60m/s')
    grid on 

figure(3)        
        hold on
        plot(C1,B1,'r-*',C2,B2,'g--o',C3,B3,'b-+')   
        hold off       
        xlabel('C_d')
        ylabel('C_l')
        title('C_l vs C_d')
        legend('V1=40m/s','V2=50m/s','V3=60m/s')
        grid on