% 6694	5/8/2010 10:50:12 AM
% Bomb Model-II Test with Body + NoseFins + TailFins + delta 0
format long g

g = 9.81;
Cl = [];
Alpha = [];
C_m = [];

%Balance load matrix
CM = [63.080043	0.144499	-0.206795	1.354260	1.630051	4.275882
    -0.123649	150.309342	0.592082	-0.725847	0.030856	0.393628
    0.024098	-0.689773	151.831777	0.096597	-0.571799	-4.414537
    0.152944	-2.334107	0.037781	77.595997	0.445712	5.841784
    -0.006030	0.114642	-0.574072	-0.065800	79.176337	0.322466
    0.047415	0.466131	0.099431	0.208017	0.190935	44.877349 ];

% Model reference parameters
% Sref(sqm)	        Chord (m)	    Span (m)
Sref = 0.009677;	c = 0.111;	    b = 0.111;

% Moment reference point (nose)
% X (m)		Y (m)		Z (m)
% 0	        0	        0

% Balance center location
%X (m)		Y (m)		Z (m)
X =-0.465;	Y = 0;	    Z = 0;

% Nowind data
%     Ax		    N1		    N2		    S1		    S2		    Rm
NW = [-0.000060	    0.000720	-0.000535	-0.000702	0.000175	-0.000938];

for i = 1:3
if i == 1
% Data for Speed 1
DyHi = 980.386364;
%       Dyn. head	Pitch		Yaw		    Roll		Ax		    N1		    N2		    S1		    S2		    Rm
DSi = [ 980.386364	-9.947917	0.000000	0.000000	0.005824	-0.018730	-0.003349	-0.000120	-0.000445	-0.000447
        980.386364	-8.052083	0.000000	0.000000	0.005779	-0.018470	0.000780	0.000486	-0.001005	-0.000446
        980.386364	-6.052083	0.000000	0.000000	0.005848	-0.015727	0.002675	0.001113	-0.001597	-0.000533
        980.386364	-4.052083	0.000000	0.000000	0.005919	-0.010716	0.002267	0.001595	-0.002072	-0.000610
        980.386364	-2.052083	0.000000	0.000000	0.006174	-0.005618	0.001225	0.002030	-0.002352	-0.000731
        980.386364	-0.052083	0.000000	0.000000	0.006382	0.000178	-0.000973	0.002233	-0.002247	-0.000805
        980.386364	0.052083	0.000000	0.000000	0.006418	0.000622	-0.001537	0.002333	-0.002409	-0.000828
        980.386364	1.947917	0.000000	0.000000	0.006301	0.005986	-0.003291	0.002541	-0.002314	-0.000872
        980.386364	3.947917	0.000000	0.000000	0.006000	0.011205	-0.004648	0.002760	-0.002287	-0.000951
        980.386364	5.947917	0.000000	0.000000	0.005786	0.016277	-0.005346	0.003033	-0.002387	-0.001062
        980.386364	7.947917	0.000000	0.000000	0.005650	0.020372	-0.004799	0.003231	-0.002487	-0.001154
        980.386364	9.958333	0.000000	0.000000	0.005792	0.020911	-0.001107	0.003629	-0.002522	-0.001206
        980.386364	11.947917	0.000000	0.000000	0.005782	0.019842	0.004121	0.003848	-0.002633	-0.001215
        980.386364	13.947917	0.000000	0.000000	0.005569	0.018813	0.009425	0.004079	-0.002668	-0.001259
        980.386364	15.947917	0.000000	0.000000	0.005211	0.017681	0.014868	0.004138	-0.002628	-0.001260
        980.386364	17.947917	0.000000	0.000000	0.004741	0.017236	0.020059	0.004069	-0.002389	-0.001278
        980.386364	19.947917	0.000000	0.000000	0.004227	0.016561	0.025673	0.003951	-0.002322	-0.001245
        980.386364	21.947917	0.000000	0.000000	0.003654	0.016103	0.031224	0.003849	-0.002502	-0.001226
        980.386364	23.947917	0.000000	0.000000	0.003050	0.016164	0.036243	0.003657	-0.002624	-0.001240
        980.386364	25.947917	0.000000	0.000000	0.002483	0.016457	0.040852	0.004120	-0.003231	-0.001296];%20
end
if i == 2
%Data for Speed 2
DyHi = 1503.238636;
%       Dyn. head	Pitch		Yaw		    Roll		Ax		    N1		    N2		    S1		    S2		    Rm
DSi = [ 1503.238636	-9.947917	0.000000	0.000000	0.008672	-0.029165	-0.004914	-0.000077	-0.000414	-0.000311
        1503.238636	-8.052083	0.000000	0.000000	0.008730	-0.029110	0.001760	0.000991	-0.001441	-0.000276
        1503.238636	-6.052083	0.000000	0.000000	0.008875	-0.024977	0.004733	0.001999	-0.002528	-0.000371
        1503.238636	-4.052083	0.000000	0.000000	0.009019	-0.017260	0.004091	0.002831	-0.003249	-0.000504
        1503.238636	-2.052083	0.000000	0.000000	0.009410	-0.009170	0.002185	0.003521	-0.003766	-0.000601
        1503.238636	-0.052083	0.000000	0.000000	0.009866	-0.000294	-0.001190	0.003980	-0.003718	-0.000728
        1503.238636	0.052083	0.000000	0.000000	0.009806	0.000650	-0.002243	0.004068	-0.003786	-0.000868
        1503.238636	1.947917	0.000000	0.000000	0.009634	0.008807	-0.004948	0.004488	-0.003806	-0.000846
        1503.238636	3.947917	0.000000	0.000000	0.009064	0.016918	-0.007061	0.004863	-0.003809	-0.001007
        1503.238636	5.947917	0.000000	0.000000	0.008705	0.024919	-0.008314	0.005317	-0.004052	-0.001171
        1503.238636	7.947917	0.000000	0.000000	0.008391	0.031412	-0.007677	0.005684	-0.004145	-0.001335
        1503.238636	9.947917	0.000000	0.000000	0.008504	0.032596	-0.002311	0.006242	-0.004257	-0.001430
        1503.238636	11.947917	0.000000	0.000000	0.008532	0.031188	0.005413	0.006732	-0.004278	-0.001513
        1503.238636	13.947917	0.000000	0.000000	0.008216	0.029086	0.013746	0.006902	-0.004357	-0.001548
        1503.238636	15.947917	0.000000	0.000000	0.007643	0.027572	0.021870	0.007058	-0.004498	-0.001615
        1503.238636	17.947917	0.000000	0.000000	0.006965	0.026547	0.030059	0.006797	-0.003870	-0.001538
        1503.238636	19.947917	0.000000	0.000000	0.006100	0.025577	0.038565	0.006591	-0.003663	-0.001523
        1503.238636	21.947917	0.000000	0.000000	0.005224	0.024703	0.047349	0.006408	-0.003872	-0.001488
        1503.238636	23.947917	0.000000	0.000000	0.004296	0.024660	0.055195	0.006309	-0.004261	-0.001527
        1503.238636	25.947917	0.000000	0.000000	0.003412	0.024635	0.062857	0.006864	-0.005023	-0.001578];
end
if i == 3
% Data for Speed 3
DyHi = 2155.477273;
%       Dyn. head	Pitch		Yaw		    Roll		Ax		    N1		    N2		    S1		    S2		    Rm
DSi = [ 2155.477273	-9.947917	0.000000	0.000000	0.012224	-0.043297	-0.006181	-0.000401	0.000118	-0.000044
        2155.477273	-8.052083	0.000000	0.000000	0.012382	-0.043300	0.003434	0.001114	-0.001542	0.000027
        2155.477273	-6.052083	0.000000	0.000000	0.012492	-0.037048	0.007539	0.002741	-0.003228	-0.000118
        2155.477273	-4.052083	0.000000	0.000000	0.012852	-0.026257	0.006930	0.003982	-0.004439	-0.000348
        2155.477273	-2.052083	0.000000	0.000000	0.013389	-0.014235	0.003861	0.005388	-0.005434	-0.000540
        2155.477273	-0.052083	0.000000	0.000000	0.014060	-0.001266	-0.001222	0.006043	-0.005342	-0.000732
        2155.477273	0.052083	0.000000	0.000000	0.013911	0.000759	-0.003306	0.006368	-0.005640	-0.000822
        2155.477273	1.947917	0.000000	0.000000	0.013731	0.012064	-0.006754	0.006798	-0.005611	-0.000923
        2155.477273	3.947917	0.000000	0.000000	0.012750	0.024123	-0.010274	0.007539	-0.005805	-0.001135
        2155.477273	5.947917	0.000000	0.000000	0.012157	0.035754	-0.012153	0.008187	-0.006238	-0.001378
        2155.477273	7.947917	0.000000	0.000000	0.011812	0.045210	-0.011220	0.008632	-0.006314	-0.001616
        2155.477273	9.958333	0.000000	0.000000	0.011769	0.047922	-0.004543	0.009309	-0.006195	-0.001753
        2155.477273	11.947917	0.000000	0.000000	0.011876	0.046518	0.005962	0.009825	-0.005895	-0.001883
        2155.477273	13.947917	0.000000	0.000000	0.011479	0.042350	0.018673	0.010167	-0.006151	-0.001922
        2155.477273	15.947917	0.000000	0.000000	0.010666	0.040216	0.030442	0.010338	-0.006394	-0.002040
        2155.477273	17.937500	0.000000	0.000000	0.009717	0.038464	0.042449	0.010045	-0.005459	-0.001934
        2155.477273	19.947917	0.000000	0.000000	0.008543	0.036833	0.054952	0.009845	-0.005513	-0.001877
        2155.477273	21.947917	0.000000	0.000000	0.007323	0.035552	0.067531	0.008894	-0.005253	-0.001782
        2155.477273	23.947917	0.000000	0.000000	0.006033	0.035056	0.079428	0.009108	-0.006263	-0.001820
        2155.477273	25.947917	0.000000	0.000000	0.004720	0.034759	0.090736	0.009236	-0.007105	-0.001772];

end
Le = 0.884;
% Transformation Matrix from CG to Body center
x = 0.2126; % Xnp --> 0.605 (Neutral point from nose)
y = 0;
z = 0;
TM =[-1,  0,  0,  0,  0,  0
      0,  1,  0,  0,  0,  0
      0,  0,  -1, 0,  0,  0
      0,  -z, y,  1,  0,  0
      z,  0,  -x, 0,  1,  0
      -y, x,  0,  0,  0,  1]; 


    for j = 1:20
        aj = [DSi(j,5) ; DSi(j,6) ; DSi(j,7) ; DSi(j,8) ; DSi(j,9) ; DSi(j,10)];
        % Convert the obtained normalized voltage signals to kg
        Aj = CM * (aj-NW);
        % Calculate the forces and moments about the balance center
        fm = [Aj(1) ; (Aj(4)+Aj(5)) ; (Aj(2)+Aj(3)) ; Aj(6) ; (Aj(2)-Aj(3))*0.065 ; (Aj(4)-Aj(5))*0.065].*g;
        % Transform the forces and moments to the body axis
        FM = [Aj(1) ; (Aj(4)+Aj(5)) ; (Aj(2)+Aj(3)) ; Aj(6) ; (Aj(2)-Aj(3))*0.065 ; (Aj(4)-Aj(5))*0.065].*g; 
        % Transform the forces and moments to the C.G of the flight vehicle
        FMcg = TM * FM;
        % The variation of longitudinal force and moment coefficients
        Cf = (1/(DyHi*Sref)).*[FMcg(1:3)];
        Cm = (1/(DyHi*Sref*Le)).*[FMcg(4:6)];
        
        Pitch = (DSi(j,2));
        % Variation of Aerodynamic force coefficients with angle of attack
        Aero_TM = [ sind(Pitch)   0   -cosd(Pitch)
                   -cosd(Pitch)   0   -sind(Pitch)
                   0              1   0];
        
        Aero_Coeff = Aero_TM*Cf;
        
        % Recording The Data
        Alpha = [Alpha; Pitch'];
        Cl  = [Cl; Aero_Coeff'];
        C_m = [C_m; Cm'];

    end
end

        A1= Alpha(1:20);
        B1= Cl(1:20,1);
        C1= Cl(1:20,2);
        D1= C_m(1:20,2);
        A2= Alpha(21:40);
        B2= Cl(21:40,1);
        C2= Cl(21:40,2);
        D2= C_m(21:40,2);
        A3= Alpha(41:60);
        B3= Cl(41:60,1);
        C3= Cl(41:60,2);
        D3= C_m(41:60,2);
        
        E1 = B1./C1;
        E2 = B2./C2;
        E3 = B3./C3;
        
        F1 = B1.^2;
        F2 = B2.^2;
        F3 = B3.^2;

% Calculating Slope of Moment Coefficient
%For V1
        cc1=0;
        Cm_Alpha1i = 0;
        Cl_Alpha1i = 0;
        k1_i=0;
        for l = 2:1:20
        D_Alpha1 =  A1(l)-A1(l-1) ;
        D_Cl1 = B1(l)-B1(l-1);
        D_Cm1 = D1(l)-D1(l-1);
        D_Cd1 = C1(l)-C1(l-1);
        D_Cl_2= F1(l)-F1(l-1);
        Cm_alpha1 = D_Cm1/D_Alpha1;
        Cl_alpha1 = D_Cl1/D_Alpha1;
        k1 = D_Cd1/D_Cl_2;
        Cl_Alpha1i = Cl_Alpha1i + Cl_alpha1;
        Cm_Alpha1i = Cm_Alpha1i + Cm_alpha1;
        k1_i = k1_i + k1;
        cc1 = cc1+1;
        end        
        F_Cm_Alpha1 = Cm_Alpha1i/cc1;
        F_Cl_Alpha1 = Cl_Alpha1i/cc1;
        F_k1 = k1_i/cc1;
        F_Cl_01 = (B1(7)+B1(6))./2;
        F_Cd_01 = (C1(7)+C1(6))./2;
        F_Cm_01 = (D1(6)+D1(7))./2;
        

        disp('For V1 = 40 m/s')
        disp('Average value of Cl_alpha')
        disp(F_Cl_Alpha1)
        disp('Average value of Cm_alpha')
        disp(F_Cm_Alpha1)
        disp('Average value of Cl_0')
        disp(F_Cl_01)
        disp('Average value of Cd_0')
        disp(F_Cd_01)
        disp('Average value of Cm_0')
        disp(F_Cm_01)
        disp('Average value of Oswald Factor')
        disp(k1)
    
%For V2
        cc2=0;
        Cm_Alpha2i = 0;
        Cl_Alpha2i = 0;
        k2_i=0;
        for l = 2:1:20
        D_Alpha2 =  A2(l)-A2(l-1) ;
        D_Cl2 = B2(l)-B2(l-1);
        D_Cm2 = D2(l)-D2(l-1);
        D_Cd2 = C2(l)-C2(l-1);
        D_Cl_22= F2(l)-F2(l-1);
        Cm_alpha2 = D_Cm2/D_Alpha2;
        Cl_alpha2 = D_Cl2/D_Alpha2;
        k2 = D_Cd2/D_Cl_22;
        Cl_Alpha2i = Cl_Alpha2i + Cl_alpha2;
        Cm_Alpha2i = Cm_Alpha2i + Cm_alpha2;
        k2_i = k2_i + k2;
        cc2 = cc2+1;
        end
        F_Cm_Alpha2 = Cm_Alpha2i/cc2;
        F_Cl_Alpha2 = Cl_Alpha2i/cc2;
        F_k2 = k2_i/cc2;
        F_Cl_02 = (B2(7)+B2(6))./2;
        F_Cd_02 = (C2(7)+C2(6))./2;
        F_Cm_02 = (D2(6)+D2(7))./2;
        disp('For V2 = 50 m/s')
        disp('Average value of Cl_alpha')
        disp(F_Cl_Alpha2)
        disp('Average value of Cm_alpha')
        disp(F_Cm_Alpha2)
        disp('Average value of Cl_0')
        disp(F_Cl_02)
        disp('Average value of Cd_0')
        disp(F_Cd_02)
        disp('Average value of Cm_0')
        disp(F_Cm_02)
        disp('Average value of Oswald Factor')
        disp(k2)
%For V3
        cc3=0;
        Cm_Alpha3i = 0;
        Cl_Alpha3i = 0;
        k3_i=0;
        for l = 2:1:20
        D_Alpha3 =  A3(l)-A3(l-1) ;
        D_Cl3 = B3(l)-B3(l-1);
        D_Cm3 = D3(l)-D3(l-1);
        D_Cd3 = C3(l)-C3(l-1);
        D_Cl_23= F3(l)-F3(l-1);
        k3 = D_Cd3/D_Cl_23;
        Cm_alpha3 = D_Cm3/D_Alpha3;
        Cl_alpha3 = D_Cl3/D_Alpha3;
        Cl_Alpha3i = Cl_Alpha3i + Cl_alpha3;
        Cm_Alpha3i = Cm_Alpha3i + Cm_alpha3;
        k3_i = k3_i + k3;
        cc3 = cc3+1;
        end
        F_Cm_Alpha3 = Cm_Alpha3i/cc3;
        F_Cl_Alpha3 = Cl_Alpha3i/cc3;
        F_k3 = k3_i/cc3;
        F_Cl_03 = (B3(7)+B3(6))./2;
        F_Cd_03 = (C3(7)+C3(6))./2;
        F_Cm_03 = (D3(6)+D3(7))./2;
        disp('For V3 = 60 m/s')
        disp('Average value of Cl_alpha')
        disp(F_Cl_Alpha3)
        disp('Average value of Cm_alpha')
        disp(F_Cm_Alpha3)
        disp('Average value of Cl_0')
        disp(F_Cl_03)
        disp('Average value of Cd_0')
        disp(F_Cd_03)
        disp('Average value of Cm_0')
        disp(F_Cm_03)
        disp('Average value of Oswald Factor')
        disp(k3)

figure(1)
subplot(4,1,1)        
        hold on
        plot(A1,B1,'r-*',A2,B2,'g--o',A3,B3,'b-+')   
        hold off       
        %xlabel('\alpha')
        ylabel('Cl')
        title('C_l vs \alpha')
        legend('V1=40m/s','V2=50m/s','V3=60m/s')
        grid on
subplot(4,1,2)
        hold on
        plot(A1,C1,'r-*',A2,C2,'g--o',A3,C3,'b-+')   
        hold off       
        %xlabel('\alpha')
        ylabel('C_d')
        title('C_d vs \alpha')
        legend('V1=40m/s','V2=50m/s','V3=60m/s')
        grid on
subplot(4,1,3)
        hold on
        plot(A1,E1,'r-*',A2,E2,'g--o',A3,E3,'b-+')   
        hold off       
        %xlabel('\alpha')
        ylabel('C_l/C_d')
        title('C_l/C_d vs \alpha')
        legend('V1=40m/s','V2=50m/s','V3=60m/s')
        grid on
subplot(4,1,4)
        hold on
        plot(A1,D1,'r-*',A2,D2,'g--o',A3,D3,'b-+')   
        hold off
        xlabel('\alpha')
        ylabel('C_m')
        %%%ylim([-2 2])
        title('C_m vs \alpha')
        legend('V1=40m/s','V2=50m/s','V3=60m/s')
        grid on

figure(2)
    hold on
    plot(F1,C1,'r-*',F2,C2,'g--o',F3,C3,'b-+')   
    hold off       
    xlabel('C_l^2')
    ylabel('C_d')
    title('C_d vs C_l^2')
    legend('V1=40m/s','V2=50m/s','V3=60m/s')
    grid on 

figure(3)        
    hold on
    plot(C1,B1,'r-*',C2,B2,'g--o',C3,B3,'b-+')   
    hold off       
    xlabel('C_d')
    ylabel('C_l')
    title('C_l vs C_d')
    legend('V1=40m/s','V2=50m/s','V3=60m/s')
    grid on